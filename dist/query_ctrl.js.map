{"version":3,"sources":["../src/query_ctrl.js"],"names":["QueryCtrl","GenericDatasourceQueryCtrl","$scope","$injector","scope","target","sourceTypeTab","type","displayDeviceBox","displayInterfaceBox","displayDifferenciationAndCurveBox","deviceID","interfaceID","metricClassID","metricID","differenciation","selectedCurve","DOMextractedRefID","rollupType","rollupTab","listOfCurves","customAlias","timeshift","query","datasource","netimGetAllDevices","netimGetInterfacesFromDevice","netimGetAllMetricClasses","netimGetMetricsFromClass","netimGetDifferenciationList","refId","netimGetCuvesList","metricFindRollupQuery","disableAllBoxBool","toggleDeviceBool","toggleInterfaceBool","panelCtrl","refresh","console","log","templateUrl"],"mappings":"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","file":"query_ctrl.js","sourcesContent":["import { QueryCtrl } from 'app/plugins/sdk';\nimport './css/query-editor.css!'\n\nexport class GenericDatasourceQueryCtrl extends QueryCtrl {\n  constructor($scope, $injector) {\n    super($scope, $injector);\n    this.scope = $scope;\n\n    // Critical attribute needed in datasource spec (self tests)\n    this.target.target = 'unused attribute';\n    // All source type available\n    this.target.sourceTypeTab = ['Device', 'Interface'];\n    // Attribute type correspond to source type (Device or Interface)\n    this.target.type = this.target.type;\n    // All boolean needed to display correct box (default is Device)\n    this.target.displayDeviceBox = this.target.displayDeviceBox;\n    this.target.displayInterfaceBox = this.target.displayInterfaceBox;\n    this.target.displayDifferenciationAndCurveBox = this.target.displayDifferenciationAndCurveBox;\n    // Attribute deviceID is the id of device selected \n    this.target.deviceID = this.target.deviceID;\n    // Attribute interfaceID is the id of the interface selected\n    this.target.interfaceID = this.target.interfaceID;\n    // Attribute metricClassID is the id of metric-class selected\n    this.target.metricClassID = this.target.metricClassID;\n    // Attribute metricID is the id of metric selected\n    this.target.metricID = this.target.metricID || \"\";\n    // Attribute differenciation is the differenciation of the metric selected (can be empty) \n    this.target.differenciation = this.target.differenciation;\n    // Depending of target.differenciation, multiple curve can be avalaible to print, user selects one\n    this.target.selectedCurve = this.target.selectedCurve;\n    // Attribute containing lettre from Grafana row\n    this.target.DOMextractedRefID = this.target.DOMextractedRefID;\n    this.target.rollupType = this.target.rollupType;\n    // this.target.rollupTab = [\"disabled\", \"aggregateavgrollup\", \"aggregateminrollup\", \"aggregatemaxrollup\", \"aggregatesumrollup\", \"durationweightedrollup\"];\n    this.target.rollupTab = []\n    this.target.listOfCurves\n    // Alias used or not by user\n    this.target.customAlias;\n    // Timeshift used or not by user\n    this.target.timeshift;\n  }\n\n\n  // These methods are called by boxes in query.editor.html and call methods from datasource.js\n\n  // Retreive all devices avalaible\n  getDeviceOptions(query) {\n    return this.datasource.netimGetAllDevices(query || '');\n  }\n\n  // Retreive all interfaces (from device in argument) avalaible\n  getInterfaceOptions() {\n    return this.datasource.netimGetInterfacesFromDevice(this.target.deviceID);\n  }\n\n  // Retreive all metric classes avalaible\n  getMetricClassOptions() {\n    return this.datasource.netimGetAllMetricClasses();\n  }\n\n  // Retreive all metrics avalaible for metric class in argument\n  getMetricOptions() {\n    return this.datasource.netimGetMetricsFromClass(this.target.metricClassID);\n  }\n\n  // Retreive all differenciation options avalaible and send current grafana query-row letter\n  getDifferenciationOptions() {\n    return this.datasource.netimGetDifferenciationList(this.target.refId || '');\n  }\n\n  // Retreives all curves returned by NetIM and send current grafana query-row letter\n  getAvailableCurveOptions() {\n    this.target.listOfCurves = this.datasource.netimGetCuvesList(this.target.refId)\n    return this.target.listOfCurves;\n  }\n\n  // Retreive all rollup algorythm avalaible and send current grafana query-row letter\n  getRollupOptions() {\n    return this.datasource.metricFindRollupQuery(this.target.refId);\n  }\n\n  // When changing source type, bind False to all boolean (all boxes disapear)\n  disableAllBoxBool() {\n    this.target.displayDeviceBox = false;\n    this.target.displayInterfaceBox = false;\n    this.target.displayDifferenciationAndCurveBox = false;\n  }\n\n  // If source type 'Device' is selected, only his boolean is set to True\n  toggleDeviceBool() {\n    this.disableAllBoxBool();\n    this.target.displayDeviceBox = true;\n  }\n\n  // If source type 'Interface' is selected, only his boolean is set to True\n  toggleInterfaceBool() {\n    this.disableAllBoxBool();\n    this.target.displayInterfaceBox = true;\n  }\n\n  // Method triggered by source type selection (a new query is being made), cleaning all up\n  runningSelect() {\n    // Reset attributes\n    this.target.deviceID = \"\";\n    this.target.interfaceID = \"\";\n    this.target.metricClassID = \"\";\n    this.target.metricID = \"\";\n    this.target.differenciation = \"\";\n    this.target.selectedCurve = \"\";\n    this.target.displayDifferenciationAndCurveBox = false;\n    // Toggling boolean depending of selected case of combobox 'Source type' (this will display concerned boxes):\n    if (this.target.type == \"Device\") {\n      this.toggleDeviceBool();\n    }\n    if (this.target.type == \"Interface\") {\n      this.toggleInterfaceBool();\n    }\n  }\n\n  // Method triggering /query in datasource.js\n  onChangeInternal() {\n    // this.target.displayDifferenciationAndCurveBox = this.datasource.needToggle(this.target.refId)\n    this.panelCtrl.refresh(); // Asks the panel to refresh data.\n    console.log(\"\\nREFRESHED\\n\");\n  }\n\n}\n\nGenericDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n\n"]}